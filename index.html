<html lang="en">
  <head>
    <title></title>
    <meta http-equiv="content-type" content="text/html; charset=utf-8">
    <link rel="stylesheet" type="text/css" href="./css/style.css">
    <script type="module">
      import ShiftRegister from './js/shift-register.mjs';
      import { Clock } from './js/clock.mjs';
      import { Snare } from './js/snare.mjs';

      let containerDiv = document.getElementById('container');

      let shiftRegister = new ShiftRegister(8);
      let bitElements = [];
      shiftRegister.bitArray.forEach((bit, index) => {
        let div = document.createElement('div');
        div.classList.add('box');
        div.innerText = index + 1;
        containerDiv.appendChild(div);
        bitElements.push(div);
      });

      let context = new AudioContext();
      let snare = new Snare(context);

      let clock = new Clock({
        onTick() {
          bitElements.forEach((bitDiv, index) => {
            if (shiftRegister.bitArray[index] === 1) {
              snare.trigger(context.currentTime);
              bitDiv.classList.add('bit-on');
            } else {
              bitDiv.classList.remove('bit-on');
            }
          });

          shiftRegister.onTick();
        }
      });
      window.myClock = clock;

      document.getElementById('clock-start-stop').addEventListener('click', function() {
        if (!clock.isRunning) {
          clock.start();
        } else {
          clock.stop();
         }
       });

       document.getElementById('write-bit').addEventListener('click', function() {
         shiftRegister.writeBit();
       });

       document.getElementById('loop').addEventListener('click', function() {
         shiftRegister.looping = !shiftRegister.looping;
       });
    </script>
  </head>

  <body>
    <div id="container" class="container">
    </div>

    <div id="clock" class="box">0</div>

    <button id="clock-start-stop">Start / Stop</button>

    <button id="write-bit">Write Bit</button>

    <button id="loop">Loop</button>
  </body>
</html>
